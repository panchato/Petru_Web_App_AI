{% extends "base.html" %}
{% block content %}
<div class="page-header">
    <div>
        <h2>Control de calidad de recepciones</h2>
        <p class="subtle">Registra mediciones y valida los totales calculados.</p>
    </div>
    <div class="page-actions">
        <a href="{{ url_for('qc.list_lot_qc_reports') }}" class="btn btn-outline-secondary">Volver al listado</a>
    </div>
</div>

<form method="POST" enctype="multipart/form-data">
    {{ form.hidden_tag() }}

    <div class="form-section">
        <h3>Datos generales</h3>
        <div class="row g-3">
            <div class="col-md-6">
                {{ form.lot_id.label(class="form-label required") }}
                {{ form.lot_id(class="form-select", aria_describedby="lot_help lot_error") }}
                <div id="lot_help" class="form-help">Selecciona el lote a evaluar.</div>
                {% if form.lot_id.errors %}
                <div id="lot_error" class="field-error" role="alert">{{ form.lot_id.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="col-md-6">
                {{ form.analyst.label(class="form-label required") }}
                {{ form.analyst(class="form-control", aria_describedby="analyst_help analyst_error") }}
                <div id="analyst_help" class="form-help">Nombre del analista responsable.</div>
                {% if form.analyst.errors %}
                <div id="analyst_error" class="field-error" role="alert">{{ form.analyst.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="col-md-6">
                {{ form.date.label(class="form-label required") }}
                {{ form.date(class="form-control", aria_describedby="date_help date_error") }}
                <div id="date_help" class="form-help">Fecha del control.</div>
                {% if form.date.errors %}
                <div id="date_error" class="field-error" role="alert">{{ form.date.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="col-md-6">
                {{ form.time.label(class="form-label required") }}
                {{ form.time(class="form-control", aria_describedby="time_help time_error") }}
                <div id="time_help" class="form-help">Hora del control.</div>
                {% if form.time.errors %}
                <div id="time_error" class="field-error" role="alert">{{ form.time.errors[0] }}</div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="form-section">
        <h3>Peso y rendimiento</h3>
        <div class="row g-3">
            <div class="col-md-6">
                {{ form.units.label(class="form-label") }}
                {{ form.units(class="form-control bg-light", readonly=true, value=form.units.data or 0, aria_describedby="units_help") }}
                <div id="units_help" class="form-help">Debe sumar 100 unidades.</div>
            </div>
            <div class="col-md-6">
                {{ form.inshell_weight.label(class="form-label required") }}
                {{ form.inshell_weight(class="form-control", aria_describedby="inshell_help inshell_error") }}
                <div id="inshell_help" class="form-help">Peso en c&aacute;scara (kg).</div>
                {% if form.inshell_weight.errors %}
                <div id="inshell_error" class="field-error" role="alert">{{ form.inshell_weight.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="col-md-6">
                {{ form.shelled_weight.label(class="form-label") }}
                {{ form.shelled_weight(class="form-control bg-light", readonly=true, aria_describedby="shelled_help") }}
                <div id="shelled_help" class="form-help">Se calcula autom&aacute;ticamente.</div>
            </div>
            <div class="col-md-6">
                {{ form.yieldpercentage.label(class="form-label") }}
                {{ form.yieldpercentage(class="form-control bg-light", readonly=true, aria_describedby="yield_help") }}
                <div id="yield_help" class="form-help">Porcentaje de rendimiento calculado.</div>
            </div>
        </div>
    </div>

    <div class="form-section">
        <h3>Colores</h3>
        <div class="row g-3">
            <div class="col-md-4">
                {{ form.extra_light.label(class="form-label") }}
                {{ form.extra_light(class="form-control") }}
            </div>
            <div class="col-md-4">
                {{ form.light.label(class="form-label") }}
                {{ form.light(class="form-control") }}
            </div>
            <div class="col-md-4">
                {{ form.light_amber.label(class="form-label") }}
                {{ form.light_amber(class="form-control") }}
            </div>
            <div class="col-md-4">
                {{ form.amber.label(class="form-label") }}
                {{ form.amber(class="form-control") }}
            </div>
            <div class="col-md-4">
                {{ form.yellow.label(class="form-label") }}
                {{ form.yellow(class="form-control") }}
            </div>
        </div>
    </div>

    <div class="form-section">
        <h3>Calibres</h3>
        <div class="row g-3">
            <div class="col-md-4">
                {{ form.lessthan30.label(class="form-label") }}
                {{ form.lessthan30(class="form-control") }}
            </div>
            <div class="col-md-4">
                {{ form.between3032.label(class="form-label") }}
                {{ form.between3032(class="form-control") }}
            </div>
            <div class="col-md-4">
                {{ form.between3234.label(class="form-label") }}
                {{ form.between3234(class="form-control") }}
            </div>
            <div class="col-md-4">
                {{ form.between3436.label(class="form-label") }}
                {{ form.between3436(class="form-control") }}
            </div>
            <div class="col-md-4">
                {{ form.morethan36.label(class="form-label") }}
                {{ form.morethan36(class="form-control") }}
            </div>
        </div>
    </div>

    <div class="form-section">
        <h3>Da&ntilde;os externos</h3>
        <div class="row g-3">
            <div class="col-md-4">
                {{ form.broken_walnut.label(class="form-label") }}
                {{ form.broken_walnut(class="form-control") }}
            </div>
            <div class="col-md-4">
                {{ form.split_walnut.label(class="form-label") }}
                {{ form.split_walnut(class="form-control") }}
            </div>
            <div class="col-md-4">
                {{ form.light_stain.label(class="form-label") }}
                {{ form.light_stain(class="form-control") }}
            </div>
            <div class="col-md-4">
                {{ form.serious_stain.label(class="form-label") }}
                {{ form.serious_stain(class="form-control") }}
            </div>
            <div class="col-md-4">
                {{ form.adhered_hull.label(class="form-label") }}
                {{ form.adhered_hull(class="form-control") }}
            </div>
        </div>
    </div>

    <div class="form-section">
        <h3>Da&ntilde;os internos</h3>
        <div class="row g-3">
            <div class="col-md-4">
                {{ form.shrivel.label(class="form-label") }}
                {{ form.shrivel(class="form-control") }}
            </div>
            <div class="col-md-4">
                {{ form.empty.label(class="form-label") }}
                {{ form.empty(class="form-control") }}
            </div>
            <div class="col-md-4">
                {{ form.insect_damage.label(class="form-label") }}
                {{ form.insect_damage(class="form-control") }}
            </div>
            <div class="col-md-4">
                {{ form.inactive_fungus.label(class="form-label") }}
                {{ form.inactive_fungus(class="form-control") }}
            </div>
            <div class="col-md-4">
                {{ form.active_fungus.label(class="form-label") }}
                {{ form.active_fungus(class="form-control") }}
            </div>
        </div>
    </div>

    <div class="form-section">
        <h3>Im&aacute;genes de calidad</h3>
        <div class="row g-3">
            <div class="col-md-6">
                {{ form.inshell_image.label(class="form-label") }}
                {{ form.inshell_image(class="form-control-file") }}
                {% if form.inshell_image.errors %}
                <div class="field-error" role="alert">{{ form.inshell_image.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="col-md-6">
                {{ form.shelled_image.label(class="form-label") }}
                {{ form.shelled_image(class="form-control-file") }}
                {% if form.shelled_image.errors %}
                <div class="field-error" role="alert">{{ form.shelled_image.errors[0] }}</div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="page-actions">
        {{ form.submit(class="btn btn-primary") }}
        <a href="{{ url_for('qc.list_lot_qc_reports') }}" class="btn btn-outline-secondary">Cancelar</a>
    </div>
</form>

<script src="{{ url_for('static', filename='js/qc-calculator.js') }}"></script>
<script>
    (function () {
        if (!window.QCCalculator) return;
        window.QCCalculator.bind();
    })();
</script>

{% endblock %}
