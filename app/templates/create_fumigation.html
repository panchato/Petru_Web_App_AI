{% extends "base.html" %}
{% block content %}
<div class="container">

    <div class="page-header">
        <div>
            <h2>Crear fumigaci&oacute;n</h2>
            <p class="subtle">Selecciona lotes disponibles y genera la orden de trabajo.</p>
        </div>
        <div class="page-actions">
            <a href="{{ url_for('list_fumigations') }}" class="btn btn-outline-secondary">Volver al listado</a>
        </div>
    </div>

    <div class="stepper" aria-label="Progreso fumigaci&oacute;n">
        <div class="stepper-item active">1. Creaci&oacute;n</div>
        <div class="stepper-item">2. Inicio</div>
        <div class="stepper-item">3. Finalizaci&oacute;n</div>
    </div>
    <div class="callout">
        Siguiente acci&oacute;n recomendada: iniciar la fumigaci&oacute;n una vez cargada la orden de trabajo.
    </div>

    <div class="form-section">
    <form method="POST">
        {{ form.hidden_tag() }}

        <div class="form-group">
            {{ form.work_order.label(class="form-label required") }}
            {{ form.work_order(class="form-control", required=True, aria_describedby="workorder_help workorder_error") }}
            <div id="workorder_help" class="form-help">Usa el identificador interno del trabajo.</div>
            {% if form.work_order.errors %}
            <div id="workorder_error" class="field-error" role="alert">{{ form.work_order.errors[0] }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.lot_selection.label(class="form-label required") }}
            <div class="border rounded p-2" style="max-height: 200px; overflow-y: auto;">
                {% for option in form.lot_selection %}
                <div class="form-check">
                    {{ option(class="form-check-input") }}
                    {{ option.label(class="form-check-label") }}
                </div>
                {% endfor %}
                {% if not form.lot_selection.choices %}
                <span class="text-muted">No hay lotes disponibles para fumigar.</span>
                {% endif %}
            </div>
            <div class="form-help">Selecciona al menos un lote para continuar.</div>
            {% if form.lot_selection.errors %}
            <div class="field-error mt-1" role="alert">{{ form.lot_selection.errors[0] }}</div>
            {% endif %}
        </div>
        <div class="form-actions">
            {{ form.submit(class="btn btn-primary") }}
            <a href="{{ url_for('list_fumigations') }}" class="btn btn-outline-secondary">Cancelar</a>
        </div>
    </form>
    </div>
</div>
{% endblock %}
