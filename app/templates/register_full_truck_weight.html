{% extends "base.html" %}
{% block content %}
<div class="page-header">
    <div>
        <h2>Registrar peso de romana</h2>
        <p class="subtle">Lote {{ '%03d' % lot.lot_number }}</p>
    </div>
    <div class="page-actions">
        <a href="{{ url_for('materiaprima.list_lots') }}" class="btn btn-outline-secondary">Volver a lotes</a>
    </div>
</div>
<div class="form-section">
    <form method="POST">
        {{ form.hidden_tag() }}
        <div class="row g-3">
            <div class="col-md-6">
                {{ form.loaded_truck_weight.label(class="form-label required") }}
                {{ form.loaded_truck_weight(class="form-control", aria_describedby="loaded_weight_error", id="loadedWeightInput") }}
                {% if form.loaded_truck_weight.errors %}
                <div id="loaded_weight_error" class="field-error" role="alert">{{ form.loaded_truck_weight.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="col-md-6">
                {{ form.empty_truck_weight.label(class="form-label required") }}
                {{ form.empty_truck_weight(class="form-control", aria_describedby="empty_weight_error", id="emptyWeightInput") }}
                {% if form.empty_truck_weight.errors %}
                <div id="empty_weight_error" class="field-error" role="alert">{{ form.empty_truck_weight.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="col-12">
                <div class="callout">
                    <strong>Previsualización de peso neto:</strong>
                    <span id="netWeightPreview">0,00 kg</span>
                    <div class="form-help mt-1">
                        Cálculo: cargado - vacío - (tara envase x cantidad envases)
                    </div>
                </div>
            </div>
        </div>
        <div class="page-actions mt-4">
            {{ form.submit(class="btn btn-primary") }}
            <a href="{{ url_for('materiaprima.list_lots') }}" class="btn btn-outline-secondary">Cancelar</a>
        </div>
    </form>
</div>
<script src="{{ url_for('static', filename='js/weight-preview.js') }}"></script>
<script>
    (function () {
        if (!window.WeightPreview) {
            return;
        }
        window.WeightPreview.bindSingle({
            loadedInputId: 'loadedWeightInput',
            emptyInputId: 'emptyWeightInput',
            previewId: 'netWeightPreview',
            tare: Number('{{ lot.raw_material_packaging.tare if lot.raw_material_packaging else 0 }}'),
            quantity: Number('{{ lot.packagings_quantity }}'),
            locale: 'es-CL'
        });
    })();
</script>
{% endblock %}
